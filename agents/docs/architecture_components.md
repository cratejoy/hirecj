# HireCJ Data Architecture - Component Diagram

## System Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER INTERFACE                                 â”‚
â”‚                   make conversation WORKFLOW=daily_briefing             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CONVERSATION GENERATOR                              â”‚
â”‚                  scripts/generate_conversation.py                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Workflow Loader â”‚  â”‚ Scenario Loader  â”‚  â”‚  Prompt Loader     â”‚   â”‚
â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚                    â”‚   â”‚
â”‚  â”‚ â€¢ daily_briefingâ”‚  â”‚ â€¢ growth_stall   â”‚  â”‚ â€¢ CJ v4.0.0       â”‚   â”‚
â”‚  â”‚ â€¢ crisis_responseâ”‚ â”‚ â€¢ churn_spike    â”‚  â”‚ â€¢ marcus_thompson â”‚   â”‚
â”‚  â”‚ â€¢ weekly_review â”‚  â”‚ â€¢ scaling_chaos  â”‚  â”‚ â€¢ sarah_chen      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AGENT LAYER                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         CJ AGENT             â”‚  â”‚      MERCHANT AGENT             â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ â€¢ Workflow-aware prompt      â”‚  â”‚ â€¢ Persona prompt               â”‚ â”‚
â”‚  â”‚ â€¢ Has data tools             â”‚  â”‚ â€¢ Scenario context             â”‚ â”‚
â”‚  â”‚ â€¢ Conversation history       â”‚  â”‚ â€¢ Emotional state              â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ Tools:                       â”‚  â”‚ Behaviors:                     â”‚ â”‚
â”‚  â”‚ - get_daily_briefing        â”‚  â”‚ - React to metrics             â”‚ â”‚
â”‚  â”‚ - analyze_customer_segment  â”‚  â”‚ - Express stress/optimism      â”‚ â”‚
â”‚  â”‚ - get_crisis_analysis       â”‚  â”‚ - Ask pointed questions        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ Tool Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATA LAYER                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      DATA AGENT              â”‚  â”‚      DATA VIEWS                 â”‚ â”‚
â”‚  â”‚   (Simulation Mode)          â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚ â€¢ DailyBriefingView            â”‚ â”‚
â”‚  â”‚ â€¢ Scenario-aware generation  â”‚  â”‚ â€¢ CrisisMetricsView            â”‚ â”‚
â”‚  â”‚ â€¢ Consistent metrics         â”‚  â”‚ â€¢ CustomerSegmentView          â”‚ â”‚
â”‚  â”‚ â€¢ Deterministic output       â”‚  â”‚ â€¢ WeeklyReviewView             â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ Base Metrics:                â”‚  â”‚ Methods:                        â”‚ â”‚
â”‚  â”‚ - MRR, Subscribers           â”‚  â”‚ - to_flash_report()            â”‚ â”‚
â”‚  â”‚ - Churn rate, Tickets        â”‚  â”‚ - to_crisis_summary()          â”‚ â”‚
â”‚  â”‚ - CSAT, Growth rate          â”‚  â”‚ - format_for_display()         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    PRODUCTION DATA PROVIDER                     â”‚  â”‚
â”‚  â”‚                        (Future State)                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ PostgreSQL  â”‚  â”‚ Materialized â”‚  â”‚ Redis Cache      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚             â”‚  â”‚ Views        â”‚  â”‚                  â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Example: Daily Briefing

```
1. CJ needs daily metrics
   â”‚
   â”œâ”€> CJ.use_tool("get_daily_briefing")
   â”‚
   â”œâ”€> DataAgent.get_daily_briefing()
   â”‚   â”œâ”€> Calculate trends from base_metrics
   â”‚   â”œâ”€> Generate ticket categories
   â”‚   â””â”€> Identify urgent issues
   â”‚
   â”œâ”€> Returns: DailyBriefingView
   â”‚   â”œâ”€> mrr: MetricTrend(current=$45k, change=+0.0%)
   â”‚   â”œâ”€> churn_rate: MetricTrend(current=5.5%, change=+5.3%)
   â”‚   â””â”€> urgent_issues: ["CAC increased 25%", "Competitor launched"]
   â”‚
   â””â”€> CJ receives formatted: "ðŸ“Š Daily Flash - May 24:..."
```

## Key Design Principles

### 1. Separation of Concerns
- **Workflows**: Define conversation patterns
- **Agents**: Handle conversation logic
- **Data Layer**: Manages all metrics and business data
- **Views**: Format data for presentation

### 2. Consistency
- All data within a conversation comes from same DataAgent instance
- Metrics are coherent (e.g., if churn is high, MRR growth is negative)
- Scenario context affects all generated data

### 3. Flexibility
- Workflows guide but don't constrain
- Agents can deviate based on conversation flow
- Data tools can be called as needed

### 4. Production Path
```
Current: CJ â†’ Tools â†’ DataAgent â†’ Synthetic Data
Future:  CJ â†’ Tools â†’ ProductionDataProvider â†’ Real Database
```

The interface remains identical, only the implementation changes.
